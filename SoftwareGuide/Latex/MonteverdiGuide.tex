%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Complete documentation on the extended LaTeX markup used for Insight
% documentation is available in ``Documenting Insight'', that is part
% of the standard documentation for Insight.  It may be found online
% at:
%
%                    http://www.itk.org
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass{InsightSoftwareGuide}


\usepackage[dvips]{graphicx}
\usepackage{times,lscape,url}
%\usepackage{mdwtab}


%%% \usepackage[latin1]{inputenc}
%%% \selectlanguage{french}
% Configuration pour les accents francais pour l'OTB
\usepackage[latin1]{inputenc}
%\usepackage[french]{babel}
\usepackage{tikz}


\usepackage{color}

\definecolor{listcomment}{rgb}{0.0,0.5,0.0}
\definecolor{listkeyword}{rgb}{0.0,0.0,0.5}
\definecolor{listnumbers}{gray}{0.65}
\definecolor{listlightgray}{gray}{0.955}
\definecolor{listwhite}{gray}{1.0}

\usepackage{listings}
\newcommand{\lstsetcpp}
{
\lstset{frame = tb,
       framerule = 0.25pt,
       float,
       fontadjust,
       backgroundcolor={\color{listlightgray}},
       basicstyle = {\ttfamily\footnotesize},
       keywordstyle = {\ttfamily\color{listkeyword}\textbf},
       identifierstyle = {\ttfamily},
       commentstyle = {\ttfamily\color{listcomment}\textit},
       stringstyle = {\ttfamily},
       showstringspaces = false,
       showtabs = false,
       numbers = none,
       numbersep = 6pt,
       numberstyle={\ttfamily\color{listnumbers}},
       tabsize = 2,
       language=[ANSI]C++,
       floatplacement=!h
       }
}
\newcommand{\lstsetpython}
{
\lstset{language=Python
        }
}
\newcommand{\lstsetjava}
{
\lstset{language=Java
        }
}


\newif\ifitkFullVersion
\itkFullVersiontrue
%\itkFullVersionfalse

\newif\ifitkPrintedVersion
\itkPrintedVersiontrue
%\itkPrintedVersionfalse


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  hyperref should be the last package to be loaded.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifitkPrintedVersion
\usepackage[dvips,
pdftitle={Monteverdi Guide},
pdfauthor={CNES},
pdfsubject={Remote Sensing, Orfeo, Pleiades, Cosmo Skymed},
pdfkeywords={image processing, Remote sensing, Guide},
pdfpagemode={UseOutlines},
bookmarks,bookmarksopen,
pdfstartview={FitH},
backref,
colorlinks,linkcolor={black},citecolor={black},urlcolor={black},
]{hyperref}
\else
\usepackage[dvips,
pdftitle={Monteverdi Guide},
pdfauthor={CNES},
pdfsubject={Remote Sensing, Orfeo, Pleiades, Cosmo Skymed},
pdfkeywords={image processing, Remote sensing, Guide},
pdfpagemode={UseOutlines},
bookmarks,bookmarksopen,
pdfstartview={FitH},
backref,
colorlinks,linkcolor={blue},citecolor={blue},urlcolor={blue},
]{hyperref}
\fi

\usepackage{amsmath,amssymb,amsfonts}
\usepackage{bbm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
%   Load configuration parameters prepared by CMake
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{SoftwareGuideConfiguration.tex}

\def\logoCNES{CNES_nom.eps}

\newtheorem{algo}{Algorithm}
\newtheorem{defin}{Definition}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%
%           The Insight Toolkit Software Guide
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{The Monteverdi Guide\\ Updated
  for OTB-3.2}

\author{OTB Development Team}

\authoraddress{
  \url{http://www.orfeo-toolbox.org}\\
  e-mail: \email{otb@cnes.fr}
}

\date{\today}


% actually write the .idx file
\makeindex

\setcounter{tocdepth}{3}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%           Begin Document
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\ifitkPrintedVersion
%% \input{PrintedPreamble.tex}
\fi

\maketitle

\frontmatter

\hyperbaseurl{http://www.orfeo-toolbox.org}

\lstsetcpp


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  Page with OTB logo
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\cleardoublepage

\begin{minipage}[t][10cm][b]{\textwidth}
\center
\includegraphics[width=0.5\textwidth]{logoVectoriel.eps}
\large
\begin{center}
\emph{The ORFEO Toolbox is not a black box.}\\
\end{center}
\hspace{8cm} Ch.D.
\normalsize
\end{minipage}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% remove headings from the following material
\pagestyle{plain}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%\ifitkPrintedVersion
%% \input{Cover.tex}
%%\fi

%\input{Abstract.tex}
\chapter*{Foreword}
\noindent


The OTB-Applications package makes available a set of simple software tools which were designed to 
demonstrates what can be done with OTB. Many users started using these applications for real processing 
tasks, so we tried to make them more generic, more robust and easy to use. OTB users have been asking 
for an integrated application for a while, since using several applications for a complete processing 
(ortho-rectification, segmentation, classification, etc.) can be a burden. Recently, the OTB team 
received a request from CNES' Strategy and Programs Office in order to provide an integrated application 
for capacity building activities (teaching, simple image manipulation, etc.). The specifications included 
ease of integration of new processing modules.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Insert Table of Contents; List of Figures and Tables
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% enable headings from the following material
\pagestyle{normal}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\small
\tableofcontents
\listoffigures
\listoftables
\normalsize




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Begin technical content
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\mainmatter

\part{User's guide}\label{part:userguide}

%\chapter{Introduction to Monteverdi}
\chapter{Getting started}
%\section{Why this software is called Monteverdi?}

\section{Installation}
The application is called Monteverdi, since this is the name of the Orfeo composer.The application allows you to build 
interactivelly remote sensing processes based on the Orfeo Toolbox library. This is also in remebering of the great 
(and once open source) Khoros/Cantata software.
Installation of Monteverdi is very simple. Standard installer packages are available for now only on MS Windows. 
For many flavors of GNU/Linux binary packages (rpm and deb) or software repositories
to add to your installation manager will be provided soon. Get the latest information on binary packages at
the OTB website at http://www.orfeo-toolbox.org/otb/download.html.

\section{Installation from source}
If you need to build Monteverdi from source, please refer to the coding and compiling guide available at
http://www.orfeo-toolbox.org/otb/documentation.html.

 
\chapter{Anatomy of the application}
\section{What does it look like?}

\begin{figure}
   \center
   \includegraphics[width=0.44\textwidth]{monteverdi_mainwindow.eps}
   \itkcaption[Monteverdi main window]{Monteverdi main window.}
   \label{fig:mainwindow}
\end{figure}

This is Monteverdi's main window (figure \ref{mainwindow} )where the menus are available and where you can see the different 
modules which have been 
set up for the processing. Input data are obtained by readers. When you choose to use a new module, you select its input data,
 and therefore, you build a processing pipeline sequentially. 
Figure \ref{inputswindow} shows the generic window which allows to specify output(s) of Monteverdi's modules. 
 
\begin{figure}
   \center
   \includegraphics[width=0.44\textwidth]{monteverdi_inputs_window.eps}
   \itkcaption[Monteverdi main window]{Monteverdi inputs selection generic window.}
   \label{fig:inputswindow}
\end{figure}
Let's have a look at the different menus. The first one is of
 course the "File" menu. This menu allows you to open a data set, to save it and to cache it. The "data set" concept is
 interesting, since you don't need to define by hand if you are looking for an image or a vector file. Of course, 
you don't need to do anything special for any particular file format. So opening a data set will create a "reader" 
which will appear in the main window. At any time, you can use the "save data set" option in order to store to a 
file the result of any processing module.




\section{Open an image with Monteverdi}
The application allows to interactively select raster/vector dataset by browsing your PC. Monteverdi takes
advantage of the automatic detection of images' extensions to indicate the dataset type (optical, SAR or vector data).   

The input dataset is added to the "Data and Process" tree whcich describes the dataset content and each node corresponds to a layer.

\section{Visualize an image with Monteverdi}
This module allows to visualize raster or vector data. It allows to create RGB composition from the imput rasters. It is also possible to add 
vector dataset which are automatically reproject in the same projection of the input image or Digital Elevation informations. 

The viewer offers three types of data visualisation: 

\begin{itemize}
\item The scroll Window : to navigate quickly inside the entire scene
\item The Full resolution window: the view of the region of interest selected in the scroll window 
\item The Zoom window
\item The Pixel description: give access to dynamic informations on the current pixel pointed. Informations display are:
  \begin{itemize}
  \item The current index
  \item The pixel value 
  \item The computed value (the dynamic of hte input image is modify to get a proper visualisation
  \item The coordinates of the current pixel (long/lat)
  \item In case where there is a Internet connection available, Monteverdi displays the estimate location of the current pixel (country + city)  
  \end{itemize} 
\end{itemize}

\begin{figure}
   \center
   \includegraphics[width=0.44\textwidth]{monteverdi_viewer_pixel_description.eps}
   \itkcaption[Monteverdi main window]{Monteverdi pixel description box.}
   \label{fig:viewerpixeldescription}
\end{figure}

The Visualization offers others great functionnalities which are available in the detached window.
Figure \ref{viewervectordata} emphase the possibility It is possible to superpose vector dataset
to the raster image (see Figure \ref{viewervectordata}).

\begin{figure}
   \center
   \includegraphics[width=0.44\textwidth]{monteverdi_viewer_vector_data.eps}
   \itkcaption[Vector Data visualization]{Monteverdi pixel description box.}
   \label{fig:viewervectordata}
\end{figure}

The "Setup Tab" allow to modify the RGB composition or use the grayscale mode to display only one layer. 

\begin{figure}
   \center
   \includegraphics[width=0.44\textwidth]{monteverdi_viewer_rgb_composition.eps}
   \itkcaption[Manage RGB composition]{Manage RGB composition.}
   \label{fig:rgbcomposition}
\end{figure}

The "Histogram Tab" get access to the dynamic of the displayed layers. The basic idea is to Convert the output of the 
pixel representation to a RGB pixel on unsigned char to be displayed on screen. 
Values are contrained to 0-255 with a transfer function and a clamping operation.
By default, the dynamic of each layer is modified by
clamping the histogram at $min + 2\%$ and $max - 2\%$. 

\begin{figure}
   \center
   \includegraphics[width=0.44\textwidth]{monteverdi_viewer_histogram.eps}
   \itkcaption[Manage the dynamic of each layer]{Manage the dynamic.}
   \label{fig:histogram}
\end{figure}

There is also possible to select pixel coordinates and get access to all the informations abvailable in the Pixel description 
Box.

\begin{figure}
   \center
   \includegraphics[width=0.44\textwidth]{monteverdi_viewer_pixel_description.eps}
   \itkcaption[Pixel description via index selection]{Index description via index selection.}
   \label{fig:pixeldescriptioninformations}
\end{figure}

\section{Cache dataset}
The "cache data set" (Figure \ref{cachingmodule}) is a very interesting thing. As you know, OTB implements processing on demand, so when you build a 
processing pipeline, no processing takes place unless you ask for it explicitly. That means that you can plug together
 the opening of a data set, an orthorectification and a spleckle filter, for example, but nothing will really be computed 
until you trigger the pipeline execution. This is very convenient, since you can quickly build a processing pipeline and 
let it execute afterwards while you have a coffee. In Monteverdi, you execute the processing by saving the result of the 
last module of a pipeline. However, sometimes, you may want to execute a part of the pipeline without wanting to give a 
name to the obtained result. You can do this by caching a data set. That is, the result will be stored in a temporary 
file which will be created in the "Caching" directory created by the application. Another situation in which you may need 
to cache a data set is when you need the input of a module to exist when you set its parameters. This is nor a real requirement, 
since Monteverdi will generate the needed data by streaming it, but this can be inefficient. This for instance about visualization
 of the result of a complex processing. Using streaming for brwsing through the result image means processing the visible part 
every time you move inside the image. Caching the data before visualization generated the whole data set in advance allowing 
for a more swift display. All modules allow you to cache their input data sets.

\begin{figure}
   \center
   \includegraphics[width=0.44\textwidth]{monteverdi_caching_module.eps}
   \itkcaption[Cache operation on the panchromatic image in progress]{Cached and streamed dataset.}
   \label{fig:pixeldescriptioninformations}
\end{figure}

\chapter{Architecture of the application}
\section{Dynamic GUI definition}
The aim of Monteverdi is to provide a generic interface which is based on the definition of the internal processes. 
In this frame, the way that that you have to manage modules are identical during the definition of a new processes.
Selecting a module on the upper main window, open automatically the "Inputs definition Window" wich allow to select data which
are inputs of the current module. Monteverdi module can manage single or multiple inputs and these inputs can be images on your 
DD or results of previous module already registered in the "Data and Process" tree.    
\section{Dynamic I/O definition}
Management of image formats in Motneevrdi works in the manner as in the OTB library.
The principle is that the software automatically recognise the image format and.
The way that
Communication between modules follow also the same principle and the Input definition of modules request to all available
outputs of the same type in the "Data and process" tree.
Internally, all the treatments in Monteverdi are compute in Float precision by default. It is also possible to switch to Double 
precision by compiling the application from source and set the CMAKE option compile float to ON.
 

\section{Dynamic chain process}
fdsfsdfsdf

\chapter{Available modules}
\section{I/O operations}
\subsection{Extract region of interest}
It allows to extract regions of interest (ROI) from an image. There are two ways to select the region:
\begin{itemize}
\item By indicating the X and Y coordinatres of the upper-left coordinates and the X-Y size of the regions.
\item By interactivelly selecting the region of interest in the input image.
\end{itemize}

\subsection{Concatenate image bands}
With Monteverdi, you could generate a large scale of value added informations from lots of inputs data. One of the basic
functionnality is to be able to superpose result's layers into the same dataset.  
Concatenating images into one single multi-band image (they need to have the same size), and to be able to create RGB composition 
with the inputs layer.

\begin{figure}
   \center
   \includegraphics[width=0.44\textwidth]{monteverdi_concatenate_before_after.eps}
   \itkcaption[Concatenation of multitemporal data]{Concatenation module.}
   \label{fig:concatenate}
\end{figure}
 
\section{Image Vizualization}
It allows to display RGB composition of raster images and vector data (ESRI Shapefile or KML). It is also possible to take 
into consideration the Digital Elevation Model by indicating the path to a directory containing SRTM files. 
\section{Geometric process}
In the frame of remote sensing process, the first operation is often to be able to superpose and maipulate imageries which 
come from different sources.
This section gives access to a large set of geometric operations.
It performs re-projection and orthorectification operations of images using the available sensor models 
(image informations available in the meta-data are automatically read by the application).  
\subsection{Orthorectification}
The application is derived from the otbOrthorectificationApplication and allow to produce orthorectified imagery from level 1 
product.
The application is able to parse metadata informations available with the image. The application contains 4 tabs:

-Positins
-Elevation informations: 
-quick view

\subsection{Re-projection module}
\subsection{Registering 2 images by taking homologous point}
This module allows to register two images by taking separately homologous points in the reference image and in the image 
that you need to register. The principle is to estimate a transformation with the list of points.
The output of the module the input image that you need to register where the calculate transformation was applied. 
\subsection{Estimating sensor model based on ground control points}
This module allows to take ground copntrol points on a raster image where you 
This GCPs list is making correspondence between pixel coordinate in the input image and physical coordinates. The list
allows to derive a general function which to translate any pixel coordinates in physical positions. This function is 
based on a RPC transformation (Rational Polynomial Coefficients). As a consequence, the module enriches the output image 
with metadata informations defining a RPC sensor model associated with the input raster. 
There is several ways to generate the GCPs:
--With a Internet connection: Dynamically generate the correspondence on the input image and Open Street Map layers
--Without an  Internet connection

It is also possible to import/export the GCP list from/to an XML file.

This output image could be without getting any geometric informations. Moreover, if the input image have already GCPs
in its metadata, the module allows to add or remove points from the existing list which is automatically loaded.       

\section{Calibration}
The basic idea is to be able to  
\subsection{Optical calibration}
In the case of the Optical calibration, the basic idea is to be able to retrieve reflectance of the observed physical object.
The input image contains only numerical which 
The process can be split in 3 main operations:
\begin{itemize}
\item Derived luminance from the numerical count in the input image. 
\item Convert the Luminance to Reflectance to produce the TOA(Top Of Atmosphere) image.
\item Inverse a radiative transfer code which simulate the reflection of solar radiation by a coupled atmosphere-surface system. This step produce 
the TOC (Top of Canopy) imagery which is the final result of the Optical calibration module. 
\end{itemize}
    
The module produce also a calculeted product which the TOC - TOA image.

\subsection{SAR calibration}

The calibration and validation of the measurement systems are important to maintain the
reliability and reproducibility of the SAR measurements but the establishment of correspondence between quantities measured 
by SAR and physical measure requires scientific background. The SAR calibration module allow to estimate quantitative accuracy
from Terra SAR X.
Describe the outputs!!!

\section{Filtering Operations}
\subsection{Band Math}
The Band Math module allow to perform simple mathematical operations (addition, substraction, multiplication) on 2 images. 
An operational example, on how this simple module can produce reliable information.
In rapid mapping context, it allows to compare easily . Figure XX shows the result of the substraction of water indices . The diiference was produce by the band math module
and allow to get a reliable estimation of the flood events.
\subsection{Feature extraction}
\subsection{Mean-shift segmentation}
\section{Learning}
\subsection{Supervised classification}
\subsection{Non-supervised classification}
The supervised classification  module is based on the Kmeans algorithm (link to the doc).
The GUI allows to modify parameters of the algorithm and produce
\section{Specific SAR functionnalities}
This section give access to specific treatments related to the 


\part{Developper's guide}\label{part:developperguide}
\chapter{Module architecture}
\chapter{Starter toolkit}

% \part{Appendix}\label{part:appendix}
% % \chapter{Frequently Asked Questions}
% % \label{sec:FrequentlyAskedQuestions}
% % \input{FAQ.tex}
% 
% \chapter{Release Notes}
% \label{sec:ReleaseNotes}
% \input{ReleaseNotes.tex}

%Comment generation of wrapping documentation for release 3.2
% \chapter{Wrappings to other languages}
%Set the code style to Java for the Wrapping

% \input{Wrapping.tex}
% 
% \input{Contributors.tex}

\backmatter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  Insert the bibliography using BibTeX
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \bibliographystyle{plain}
\bibliographystyle{abbrv}
\bibliography{\bibtexdatabasepath/Insight}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%  Insert the Index file
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\InputIfFileExists{MonteverdiGuide.ind}




%%\ifitkPrintedVersion
%%\cleardoublepage
%%% \input{MarketingMaterial.tex}
%%\fi



\end{document}



